# Account Analysis App

Agentforce-powered Lightning App Page that provides comprehensive account intelligence, relationship health analysis, and company research for Salesforce Accounts.

## Features

- ğŸ¤– **Agentforce-Powered Health Scoring** - Automated 0-100 health score with status levels (Excellent, Good, Moderate, At Risk, Critical)
- ğŸ“Š **Relationship Health Analysis** - Sentiment analysis of customer communications with actionable insights
- ğŸ” **Company Research** - Web-based company intelligence via Tavily API (overview, industry, products, executives, news)
- ğŸ“ˆ **Comprehensive Metrics** - Tracks emails, tasks, cases, opportunities, and engagement patterns
- âš¡ **Auto-Trigger Analysis** - Analysis starts automatically when an account is selected

## Prerequisites

- Salesforce Org (Developer Edition, Sandbox, or Production)
- Salesforce CLI installed and authenticated
- System Administrator permissions
- [Tavily API Key](https://tavily.com) (for company research)
- Einstein AI enabled in your org (OpenAI GPT-4o mini and Gemini 2.5 Pro)

## Quick Start

### 1. Download Assets

Download the pre-built assets: **[accountAnalysisAppAssets.zip](/accountAnalysisAppAssets.zip)**

Extract the zip file to your local machine.

### 2. Set Up Project

```bash
# Create new Salesforce project
sf project generate --name account-analysis-app
cd account-analysis-app

# Or use existing project
```

### 3. Organize Files

Copy extracted files to your project following this structure:

```
force-app/main/default/
â”œâ”€â”€ lwc/
â”‚   â”œâ”€â”€ accountAnalysisApp/
â”‚   â”œâ”€â”€ accountRelationshipHealth/
â”‚   â””â”€â”€ accountResearch/
â”œâ”€â”€ classes/
â”‚   â”œâ”€â”€ AccountRelationshipHealthController.cls
â”‚   â”œâ”€â”€ AccountCompanyResearchController.cls
â”‚   â”œâ”€â”€ AccountHealthAnalysis.cls
â”‚   â”œâ”€â”€ AccountHealthMetrics.cls
â”‚   â”œâ”€â”€ LeadCompanyResearchResult.cls
â”‚   â””â”€â”€ AccountRelationshipHealthControllerTest.cls
â””â”€â”€ flexipages/
    â””â”€â”€ Account_Analysis_App.flexipage-meta.xml
```

### 4. Deploy to Org

Create `manifest/package.xml`:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<Package xmlns="http://soap.sforce.com/2006/04/metadata">
    <types>
        <members>AccountRelationshipHealthController</members>
        <members>AccountRelationshipHealthControllerTest</members>
        <members>AccountCompanyResearchController</members>
        <members>AccountHealthAnalysis</members>
        <members>AccountHealthMetrics</members>
        <members>LeadCompanyResearchResult</members>
        <name>ApexClass</name>
    </types>
    <types>
        <members>accountAnalysisApp</members>
        <members>accountRelationshipHealth</members>
        <members>accountResearch</members>
        <name>LightningComponentBundle</name>
    </types>
    <types>
        <members>Account_Analysis_App</members>
        <name>FlexiPage</name>
    </types>
    <version>62.0</version>
</Package>
```

Deploy:

```bash
sf project deploy start --manifest manifest/package.xml --target-org your-org-alias
```

Run tests:

```bash
sf apex run test --class-names AccountRelationshipHealthControllerTest --result-format human
```

## Configuration

### 1. Remote Site Settings

Setup â†’ Remote Site Settings â†’ New Remote Site
- **Remote Site Name**: `Tavily_API`
- **Remote Site URL**: `https://api.tavily.com`
- **Active**: âœ“

### 2. Tavily API Configuration

1. Create Custom Metadata Type:
   - Setup â†’ Custom Metadata Types â†’ New
   - **Label**: `Tavily API Config`
   - **Plural Label**: `Tavily API Configs`
   - **Object Name**: `Tavily_API_Config`

2. Add Field:
   - **Field Label**: `API Key`
   - **Field Name**: `API_Key__c`
   - **Data Type**: `Text` (Length: 255)

3. Create Record:
   - Setup â†’ Custom Metadata Types â†’ Tavily API Config â†’ Manage Records â†’ New
   - **Developer Name**: `Default` (must be exactly "Default")
   - **API Key**: Enter your Tavily API key

### 3. Enable Einstein AI

Setup â†’ Einstein Setup â†’ Enable **Einstein Generative AI**

Ensure your user profile has Einstein AI permissions enabled.

### 4. Create Lightning Tab

Setup â†’ Tabs â†’ Lightning Component Tabs â†’ New
- **Lightning Component**: `c:accountAnalysisApp`
- **Tab Label**: `Account Analysis`
- **Icon**: Choose appropriate icon

### 5. Create App Page

Setup â†’ App Manager â†’ Lightning App Pages â†’ New
- **Label**: `Account Analysis App`
- **Developer Name**: `Account_Analysis_App`
- Add `c:accountAnalysisApp` component to the page
- Activate the page

### 6. Add to App Navigation

Setup â†’ App Manager â†’ Edit your app â†’ Add "Account Analysis" to navigation items

## Usage

1. Navigate to the Account Analysis tab or App Page
2. Select an Account from the picker
3. Analysis starts automatically:
   - **Relationship Health** component displays health score, metrics, insights, and recommendations
   - **Account Research** component displays company intelligence from web research

## Tech Stack

- **Lightning Web Components (LWC)** - Modern Salesforce UI framework
- **Apex** - Backend logic and data aggregation
- **Einstein AI** - OpenAI GPT-4o mini (health analysis) and Vertex AI Gemini (research parsing)
- **Tavily Search API** - Web search for company research
- **Lightning Design System (SLDS)** - Salesforce styling

## File Structure

```
force-app/main/default/
â”œâ”€â”€ lwc/
â”‚   â”œâ”€â”€ accountAnalysisApp/          # Main container component
â”‚   â”œâ”€â”€ accountRelationshipHealth/   # Health analysis component
â”‚   â””â”€â”€ accountResearch/              # Company research component
â”œâ”€â”€ classes/
â”‚   â”œâ”€â”€ AccountRelationshipHealthController.cls    # Health metrics & AI
â”‚   â”œâ”€â”€ AccountCompanyResearchController.cls        # Research & parsing
â”‚   â”œâ”€â”€ AccountHealthAnalysis.cls                   # Analysis wrapper
â”‚   â”œâ”€â”€ AccountHealthMetrics.cls                    # Metrics wrapper
â”‚   â”œâ”€â”€ LeadCompanyResearchResult.cls               # Research result wrapper
â”‚   â””â”€â”€ AccountRelationshipHealthControllerTest.cls # Test class
â””â”€â”€ flexipages/
    â””â”€â”€ Account_Analysis_App.flexipage-meta.xml     # App page definition
```

## Troubleshooting

**Component not appearing**: Verify `isExposed` is `true` in component metadata and component is deployed.

**No research data**: Check Tavily API key is configured in Custom Metadata with Developer Name "Default".

**AI errors**: Verify Einstein AI is enabled and user has Einstein AI permissions.

**No health data**: Ensure Account records have related data (cases, opportunities, emails).

## License

This project is provided as-is for use in Salesforce orgs.

